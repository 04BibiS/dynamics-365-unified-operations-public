---
# required metadata

title: Distributed order management (DOM)
description: This topic describes distributed order management (DOM) functionality in Dynamics 365 for Retail.
author: josaw1
manager: AnnBe
ms.date: 11/15/2018
ms.topic: index-page
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 

# optional metadata

# ms.search.form: 
# ROBOTS: 
audience: Application User
# ms.devlang: 
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
# ms.tgt_pltfrm: 
ms.custom: 
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: josaw
ms.search.validFrom: 2018-11-15
ms.dyn365.ops.version: 

---
# Distributed order management (DOM)

In the new paradigm of retail operations, retailers strive to provide personalized customer engagement, omni-channel experiences, and frictionless interactions. With so many choices available, consumers can shop wherever they can get a more favorable experience. Price and product are commonly no longer the top deciders for them.

To help improve the customer experience, retailers need visibility into their inventory in real-time across all their channels. A single, holistic view of all the inventory can help optimize order fulfillment, allocation, and distribution.

To that end, adaptation and implementation of a distributed order management (DOM) system is becoming more imperative for retailers. DOM optimizes order fulfillment across a complex network of systems and processes. It relies on a single, global view of inventory across an entire organization to intelligently manage orders, so order are fulfilled accurately and more cost-effectively. DOM helps to improve the efficiency of a retailer’s supply chain, allowing them to better meet customer expectations.

The lifecycle of a sales order within a DOM system is illustrated below.



![Sales order lifecycle in the context of DOM](./media/flow.png "Sales order lifecycle in the context of DOM")

## Set up DOM

1.  Go to **System administration > Setup > License configuration**. Expand **Retail** under **Configuration keys** and then check the **Distributed Order Management** box.

2.  Go to **Retail > Distributed order management > Setup > DOM parameters**. On the **General** tab, configure the following.

- Set **Enable distributed order management** to **Yes**.

- Set **Confirm Bing Maps usage for DOM** to **Yes**. This parameter can only be set to **Yes** if the parameter under **Retail > Headquarters setup > Parameters > Retail shared parameters > Bing Maps > Enable Bing Maps** is also set to **Yes** and a valid key is provided in the **Bing Maps key** field.

- Specify a value in the **Retention period in days** field. This parameter determines how long the fulfillment plans that are generated by DOM runs are retained in the system. Any fulfillment plan that is older than the number of days defined in this parameter will be deleted by the batch job **DOM fulfillment data deletion job setup**.
      
 - Specify a value in the  **Rejection period** field. This parameter defines how long a rejected order line will not be assigned to the same location.    

3.  On the **Solver** tab, do the following.

- Specify a value in the  **Max auto-fulfillment attempts** field. This parameter governs how many attempts the DOM engine will make to broker an order line to a location. If the DOM engine is not able to broker the order line to a location in the number of attempts as defined in this parameter, the DOM engine will flag the relevant order line as an exception and will skip the line from future execution runs until the status is manually reset.

- Specify a value in the  **Local store region radius** field. This parameter helps to configure how locations are grouped and considered to be equal in terms of distance. For example, if the value in this parameter is set to 100, then every store or distribution center within a 100-mile radius of the fulfillment address is considered equal in terms of distance.
      
- Specify a value in the **Solver type** field. There are two solver types that are shipped with Retail; "Production Solver" and "Simplified Solver". All machines that are intended to run DOM (all servers that are part of the DOMBatch group) must be set to "Production Solver". "Production Solver" needs the special license key that is by default licensed and deployed on production environments. For non-production environments, this license key must be manually deployed. To manually deploy the license key, follow these steps.
	- Download the "DOM license" file from **LCS > Shared asset library > Model**.
        - Open **IIS manager**, right click **AOSService website**, and then click **Explore**. A windows explorer window will open at <AOS service root>\webroot. Note the <AOS Service root> path for the next step.
        - Copy the configuration file in the <AOS Service root>\PackagesLocalDirectory\DOM\bin directory.
	- Go to the to HQ client and open the **DOM Parameters** page. On the  **Solver** tab, in the **Solver type** field, select **Production solver** and confirm that no error messages are displayed.
      
      
      	 > [!NOTE]
    	 > "Simplified Solver" is provided so retailers can try out the DOM feature without having to deploy the special license. Organizations should not use the "Simplified Solver" in Production environments
   	 > While "Simplified Solver" provides the same set of capabilities as "Production Solver", there are limitations around performance (number of orders and order lines it can handle in a run) and convergence of results (may not be the best result with a batch of orders in specific scenarios).
	 
4. Go back to **Retail > Distributed order management > Setup > DOM parameters**. on the **Number sequences** tab, assign the required number sequences to the different DOM entities. The number sequences must be defined under **Organization administration > Number sequences > Number sequences** before they can be assigned to the entities.

5. The DOM feature supports the definition of different types of DOM rules. DOM rules can be defined for a group of locations or individual locations, and for a certain product category, product, or variant. The grouping of locations that needs to be used for the DOM rules can be created using the following steps.

- Go to **Retail > Channel setup > Fulfillment groups**.

- Click **New** and enter a group name and description.

- Click **Save**.

- Click **Add line** to add a signle location to the group, or **Add lines** to add multiple locations.

6. DOM supports the definition of different types of DOM rules, and organizations can choose to configure multiple rules based on business needs. Rules can be defined at **Retail > Distributed order management > Setup > Manage rules**. Below are all the currently supported DOM rules.

- **Minimum inventory rule:** This rule type helps organizations to ring fence a specific quantity of a product for non-order fulfillment purposes. For example, organizations may not want all the inventory that is available in a store to be considered by DOM for order fulfillment. They may want to reserve some quantity for their walk-in customers. This can be achieved by leveraging this rule type. A minimum inventory to be retained can be defined per location or a group of locations for a category of products, individual product, or a product variant.

- **Fulfillment location priority rule:** This rule type allows organizations to define a hierarchy of locations by the priority which the DOM engine will consider when trying to identify fulfillment locations for specific products. Locations with higher priority are considered first before resolving to other locations. A location with a priority of 1 is of higher priority than a location with priority 2. The valid range of priorities is 1 to 10. If the rule is defined as a hard constraint rule, then the orders are only brokered to locations that have priorities defined for them.

- **Partial orders rule:** This rule allows an organization to define whether an order or order lines can be fulfilled partially. The behavior resulting from the available parameters are as follows.
		- **Fulfill partial orders**: If this is set to **Yes**, DOM is allowed to fulfill only part of the quantity on an order line. This is achieved by splittig the order line.
		- **Fulfill partial lines**: If this is set to **Yes**, DOM can fulfill a partial quantity of order lines.This is achieved by splitting the order line.  
		- **Fulfill from one location**: If this is set to **Yes**, DOM will ensure that all lines on an order will be fulfilled from a single location.
       
The table below explains the behavior when a combination of the above parameters are defined.

|  | **Fulfill partial order** | **Fulfill Partial lines** | **Fulfill from one location only** | **Description**                                                                                                                                                                                  |
|--------|---------------------------|---------------------------|------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1      | Yes                       | Yes                       | Yes                                | Few lines of the order can be fulfilled, individual lines can be partially fulfilled, but all of them must be from the same location in an instance of DOM run. (Not currently supported.)                                    |
| 2      | Yes                       | No                        | Yes                                | Few lines of the order can be fulfilled, however individual lines cannot be partially fulfilled, and the fulfilled lines must be from the same location in an instance of the DOM run, (Not currently supported.)              |
| 3      | Yes                       | Yes                       | No                                 | Few lines of the order can be fulfilled, individual lines can be partial fulfilled, and each individual line can be fulfilled from more than one location in an instance of the DOM run.      |
| 4*    | No                        | -                         | No                                 | All order lines must be fulfilled, lines cannot be partially fulfilled, and each order line can be fulfilled from a different location.                        |
| 5*    | No                        | -                         | Yes                                | All order lines must be fulfilled, the lines cannot be partially fulfilled, and all the order lines can be delivered from one location only.                                 |
| 6*    | No                        | -                         | No                                 | Same as #4, because **Fulfill partial lines** cannot be set to **Yes** when **Fulfill partial order** is set to **No**.                                                                                                  |
| 7*    | No                        | -                         | Yes                                | Same as #5 because **Fulfill partial lines** cannot be **Yes** when **Fulfill partial order** is **No**.                                                                                                   |
| 8      | Yes                       | No                        | No                                 | Few lines of the order can be fulfilled but individual lines cannot be partially fulfilled. The different order lines can be fulfilled from more than one location in an instance of the DOM run. |
| 9*    | No                        | -                         | Yes                                | All order lines must be fulfilled and all the order lines have to be fulfilled from one location only                                                                                            |

\* If **Fulfill partial order** is set to **No**, then **Fulfill partial lines** is always considered to be **No**, regardless of how it's set.

- **Offline fulfillment location rule:** This rule allows the organization to specify a location or group of locations as off-line or unavailable to DOM for assigning orders for fulfillment.

- **Maximum rejects rule:** This rule allows the organization to define a threshold for rejects. Upon hitting the rejects threshold, the DOM processor will mark an order or order line for exception and exclude it from further processing.
          After order lines are assigned to a location, the location has the option to reject the assigned order line, as they may not be able to fulfill it for multiple reasons. Rejected lines are marked as exception and put back in the pool for processing in the next run. In the next run, DOM will try and assign that line to a different location. After assignment, the new location can also reject the order line for fulfillment. This cycle of assignment and rejection can happen multiple times and the moment the rejection count hits the threshold as defined by this rule, DOM will mark this order line as a permanent exception and won't pick the line for assignment again. DOM will consider the order line again for reassignment only if a user manually resets the status of the order line.

- **Maximum distance rule:** This rule allows the organization to define the maximum distance a location or group of locations can go out to fulfill the order. If there are overlapping maximum distance rules define for a location, then DOM will apply the lower of the defined maximum distance for that location.

- **Maximum orders rule:** This rule allows the organization to define the maximum number of orders a location or group of locations can process in a calendar day. If a location is assigned the maximum number of orders in a single day, then DOM will not assign any more orders to that location for that calendar day.
   
Some of the common attributes that can be defined for all the above rule types are as follows.

- **Start date** and **End date**: Every rule can be date-bound using the these fields.

- **Disabled**: Rules that have a value of **No** defined in this field are the only rules that are considered in a DOM run.

- **Hard constraint**: A rule can be defined either as a hard constraint or not as a hard constraint. Every DOM run goes through two iterations as follows. In the first iteration, every rule is treated as a hard constraint rule regardless of this setting. In other words, every rule is applied. The exception is the **Location priority** rule. In the second iteration, the rules that were not defined as hard constraints are removed and the order or order lines that are not assigned to locations when the full rule set was applied are assigned to locations with a reduced rule count (as the non-hard constraints rules are removed).


7.  Fulfillment profiles are used to group a collection of rules, legal entities, sales order origins, and modes of delivery. Every DOM run is for a specific fulfillment profile. That way, organizations can define and execute a set of rules for a set of legal entities, on orders with specific sales order origins and modes of delivery. So, if different set of rules are to be executed for different sets of sales order origins or modes of delivery, they can be configured and executed by defining the fulfillment profiles accordingly.

	To set up fulfillment profiles, do the following.	
	
	1. Go to **Retail > Distributed order management > Setup > Fulfillment profiles**.

	2. Click **New**.
	
	3. Enter values in the **Profile** and **Description** fields.
	
	4. In the **Auto apply result** field, enter **Yes** or **No**. If this field is set to **Yes**, the results of the DOM execution for the profile will be automatically applied to the sales order lines. If it is set to **No**, the results can only be viewed in the fulfillment plan and they will not be applied to the sales order lines.
	
	5. If you want the DOM profile to be executed for orders with every sales order origin value including undefined ones, set the field **Process orders with empty sales origin** to **Yes**. If you want to execute the profile for a few sales order origins only, you can define those in the "Setup" section of the profiles (explained below).
		
	6. On the **Legal entities** fast tab, click **Add** and select a legal entity.
	
	7. On the **Rules** fast tab, click **Add** and then select the rule that you want to link to the profile.
	
	8. Repeat the previous two steps until all the required rules are associated to the profile.
		
	9. Click **Save**.
	
	10. On the menu, click **Setup** and then click **Modes of delivery**.
	
	11. Click **New**.
	
	12. In the **Company** field, select the legal entity. The list of companies available is limited to the company added in the "Legal entity" section of the fulfillment profiles. 
	
	13. In the **Mode of delivery** field, select the mode of delivery for which you want to associate this profile. A mode of delivery cannot be associated to multiple active profiles.
	
	14. Repeat the previous two steps until all the required modes of delivery are associated to the profile.
	
	15. Close the page.
	
	16. On the menu, click **Setup** and then click **Sales order origins**.
	
	17. Click **New**.
	
	18. In the **Company** field, select the legal entity. The list of companies available is limited to the company added in the "Legal entity" section of the fulfillment profiles.
	
	19. In the **Sales origin** field, select the sales origin for which you want to associate this profile. A sales origin cannot be associated to multiple active profiles.
	
	20. Repeat the previous two steps until all the required sales origins are associated to the profile.
	
	21. Close the page.
	
	22. Set **Enable profile** to **Yes**. If there are any errors in the setup, the system will produce a warning message.


## DOM processing

DOM will only run in a batch job. To configure the batch job for DOM runs, do the following.

1. Go to **Retail > Distributed order management > Batch processing > DOM processor job setup**.
   
1. In the **Fulfillment profile** field, select a profile for which the DOM execution must be run.
   
1. Select a configured Batch group.
   
1. Specify a name for the batch job. 
    
1. On the **Recurrence** tab, define the recurrence of the batch job.
   
1. Click **OK**

At the time of processing, DOM will consider the order and order lines as described below.

- Order lines that meet the criteria for sales order origins, modes of delivery, and legal entity as defined in the DOM profile, and:

   - Are created from retail channels.
   
   - Are never brokered by DOM.
   
   - Have been brokered by DOM before but are marked as exception and are below the maximum threshold attempt.
   
   - Where the mode of delivery is not pick-up or electronic delivery.
   
   - Are not marked for delivery.
   
   - Are not manually excluded.
   
   - Orders that are not on hold.

After applying the rules, inventory constraints, and& optimization, DOM will pick a location that is closest to the customer’s delivery address.

![Sales order criteria](./media/ordercriteria.png "Sales order criteria")


## DOM execution results

If the fulfillment profile is set to “Auto apply”, the results of the execution run will be automatically applied to the sales order lines and the fulfillment plan can be viewed separately. However, if the fulfillment profile is not set to “Auto apply”, then the results of the execution can be seen only from the fulfillment plan view. 

To view all of the generated fulfillment plans, do the following.

1.  Go to **Retail > Distributed order management**.

2.  Click the **Fulfillment plans** tile.

3.  Click the relevant order fulfillment plan ID to see the fulfillment plan.

4.  The order details section of the plan shows the original sales order lines that were part of the execution. Beyond the standard sales order line fields, the order details section also shows the following three DOM related fields.

- **Fulfillment type:** This field indicates whether the sales order line is fully brokered, partially brokered, not brokered at all to a location.

- **Split:** This field indicates if one sales order line has been split and brokered to different locations.

- **No. of fulfillment locations:** This field indicates how many fulfillment lines were created for one sales order line (based on how many locations was that one original sales order line brokered to).

5.  The order fulfillment details section shows the assignment of the original sales order lines to different locations along with their quantities.


## Order line actions and statuses
<!---
I don't know where this UI is for any of these items. Please be more specific
-->
<!---
fix the wording here
-->

- If you set the **Exclude from DOM processing** field on the **General** tab to **Yes**, the order or order line will be excluded from DOM processing.

- The **DOM status** field on the **General** tab of the sales order line can be set to one of the values below.

	- **None:** The order line has never been brokered.

	- **Complete:** The order line is successfully brokered and assigned to a location.

	- **Exception:** The order line is brokered but cannot be assigned to a location. There are multiple sub-types for exceptions which can be viewed from the DOM workspace. The sub-types for exception are as follows.
    
	1. **No quantity available:** Inventory is not available in the locations to assign the order to.
       
	2. **Maximum rejections:** The order line has reached the maximum rejection threshold.
       
	3. **Data modification conflict:** The sales order line has been changed since the order was brokered and therefore the fulfillment plan cannot be applied to the order.
       
	4. **Order line specific exception:** There are multiple exceptions on the order line.

- DOM can be run in an interactive mode during the sales order entry process. While entering the order line, after specifying the product and quantity, the user can use the option **Suggest fulfillment location** under **Update line > DOM** to get a list of locations based on DOM rules that can fulfill the quantity on the order line. The list of locations is sorted by distance. Choosing a location sets the relevant site and warehouse on the sales order line. For this functionality to work, there must be an existing and active fulfillment profile that matches the sales origin and delivery mode as on the sales line.

- The user can see the DOM run logs for a sales order line using the option **View DOM logs** under **Sales order line > DOM.** The DOM logs show the user all the events and logs generated by the DOM run. The logs can help the user understand why a specific location was assigned to the order line and what rules and constraints were considered as a part of the assignment. The DOM logs are also available at the sales order header level on the **Manage** tab.

## Run a DOM fulfillment plan clean-up job

As DOM runs are being executed, fulfillment plans get created. Over a period, the system will retain numerous fulfillment plans. To manage the number of fulfillment plans that are retained, a batch job based on the **Retention period in days** value can be configured to delete older fulfillment plans.

1. Go to **Retail > Distributed order management > Batch processing > DOM fulfillment data deletion job setup**.
   
1. In the **Batch group** field, select a configured batch group.
   
1. Click the **Recurrence** tab to define the recurrence of the batch job.
   
1. Click **OK**

## More information

The below are some of the things to factor for in the usage of DOM feature:

- Currently, DOM only looks at orders created from Retail channels. Sales orders are identified as retail sales orders when the field **Retail sale** is set to **Yes**.
   
- Microsoft has not tested DOM with advanced warehouse management features. Due diligence from customers and partners is required to determine whether DOM is compatible with the advanced warehouse management capabilities and processes that are relevant to them.
   
- DOM is only available on the Cloud version of Dynamics 365 for Retail. It is not supported in an on-prem deployment.


